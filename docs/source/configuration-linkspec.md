# Link configuration and linkspec

## Link configuration file

At the heart of each `link` operation is a YAML configuration file, which defines how symbolic links should be created to make a Unity project. By default, the file is named `upkit.yaml`, and can be changed to whatever needed. A typical configuration should look like this:

```yaml
params:
  project: '{{__dir__}}/project'
  project_packages: '{{__dir__}}/packages'

links:
  - source: '{{project_packages}}/Scripts'
    target: '{{__assets__}}/Scripts'
```

### Parameters

To make linking more configurable, there are two types of parameters supported by Upkit: 
* **Built-in parameters:** those with name enclosed by `__`, for instance `__dir__` and `__assets__`, are generated by Upkit and shall not be defined. The list of built-in parameters are defined [here](#builtin-parameters).
* **User parameters:** those defined by user, under `params` section.

For each configuration file, there *MUST* be a `project` parameter defined, which tells Upkit where to generate the links. 
 
#### Defining and expanding parameters
Defining a parameter can be as simple as:

```yaml
params:
  some_param: 'some value'
```

However, most of the time, parameters are defined by expanding other existing parameters using Jinja syntax, such as:
```yaml
params:
  platform: 'ios'
  project: '{{__dir__}}/project-{{platform}}'
  project_settings: '{{project}}/ProjectSettings'
```

#### Builtin parameters

The table below describes Upkit built-in parameters. 

| Name          | Description                                                               |
|---------------|---------------------------------------------------------------------------|
| `__cwd__`     | Path to current working folder.                                           |
| `__dir__`     | Path to the folder containing the current configuration or linkspec file. |
| `__project__` | Path to the Unity project.                                                |
| `__assets__`  | Path to the Unity project's Assets folder.                                |
| `__plugins__` | Path to the Unity project's Plugins folder.                               |
| `__source__`  | The source parameter in a linkspec.                                       |
| `__target__`  | The target parameter in a linkspec.                                       |

Note that only `__cwd__` and `__dir__` are accessible in `params` section. 

#### Overwriting parameters

Given a configuration, its user-defined parameters can be overwriten at runtime by passing `-p name=value` to the `link` command. This is particularly useful when you need to use the configuration file as a template for multiple Unity projects with slightly different parameters. For example, a configuration for multiple platforms may look like: 

```yaml
params:
  platform: 'ios'
  project: '{{__dir__}}/project-{{platform}}'
...
```

Execute the following commands:
```
$ upkit link
$ upkit link -p platform=android
$ upkit link -p platform=windows 
```

will create `project-ios`, `project-android` and `project-windows` as separate Unity project folders.

### Linkspec

To generate Unity projects, Upkit requires a list of link specifications, or *linkspec*s, which is basically a way to tell Upkit where to find a package, which part of its content (all or partial) and a target to which the content is linked. A linkspec may be defined using parameters in the table below:

**Linkspec properties**

| Name      | Description                                                                                                |
|-----------|------------------------------------------------------------------------------------------------------------|
| `source`  | Source package location, can be a local or remote package.                                                 |
| `content` | A list of glob patterns describing a set of files or folders as the source content.                        |
| `exclude` | A list of glob patterns describing a set of files or folders should not be included in the source content. |
| `target`  | The target to which the source files or folder is linked.                                                  |
| `links`   | A list of sub-linkspecs for even more complex linking.                                                     |

Depending on which parameters are given, a linkspec instructs Upkit to operate in one of these modes:
* **One-to-one:** when `source` is provided but not `content` and `links`. In this mode, Upkit links one source file or folder under the link `target`. 
* **Many-to-one:** when `content` is provided but not `links`. In this mode, Upkit links files or folders match the patterns in `content` 

#### `source` property
* **Defines** a local source file, folder, or a remote Nuget package or Git repository.
* **Is required** when `content` and `links` are missing.
* **Has format** as one of
  * `/path/to/local-file-or-folder` to define a local file or folder.
  * `nuget:(package_id)@(package_version)[#(sub_path)]` to define a Nuget package, where `package_id` and `package_verion` are required, and `sub_path` is optional.
  * `git:(repository_url)[@(branch_or_tag)][#(sub_path)]` to define a Git repository, where `repository_url` is required and `branch_or_tag` and `sub_path` expression.

Note that
* If `nuget:` or `git:` is used, the respective Nuget package or Git repository is resolved to a local folder specified by `-w` parameter, which is then used as a local source.
* If  `nuget:` or `git:` is used and `sub_path` is given, the child file or folder by `sub_path` in the resolved package folder is used as a local source.
  
Examples:
* `{{__dir__}}/Scripts`
* `nuget:NewtonSoft.Json@11.0.2`
* `nuget:NewtonSoft.Json@11.0.2#lib/net35` 
* `git:https://github.com/finderseyes/upkit.git@develop`
* `git:https://github.com/finderseyes/upkit.git#examples/simple-app`
* `git:https://github.com/finderseyes/upkit.git@develop#examples/simple-app` 

#### `content` property

* **Defines** a set of files or folder 
* **Is required** when `source` and `links` are missing.
* **Has format** as one of
  * `/path/to/local-file-or-folder` to define a local file or folder.
  * `nuget:(package_id)@(package_version)[#(sub_path)]` to define a Nuget package, where `package_id` and `package_verion` are required, and `sub_path` is optional.
  * `git:(repository_url)[@(branch_or_tag)][#(sub_path)]` to define a Git repository, where `repository_url` is required and `branch_or_tag` and `sub_path` expression.

Note that
* If `nuget:` or `git:` is used, the respective Nuget package or Git repository is resolved to a local folder specified by `-w` parameter, which is then used as a local source.
* If  `nuget:` or `git:` is used and `sub_path` is given, the child file or folder by `sub_path` in the resolved package folder is used as a local source.

<!-- #### Defining local sources


#### Linkspec 

#### Link a local file or folder

#### Link a set of files in a local folder

#### Link a Nuget package 

#### Link a Git package -->


## Package linkspec

### Overwrite package linkspec
