# Link configuration and linkspec

## Link configuration file

At the heart of each `link` operation is a YAML configuration file, which defines how symbolic links should be created to make a Unity project. By default, the file is named `upkit.yaml`, and can be changed to whatever needed. A typical configuration should look like this:

```yaml
params:
  project: '{{__dir__}}/project'
  project_packages: '{{__dir__}}/packages'

links:
  - source: '{{project_packages}}/Scripts'
    target: '{{__assets__}}/Scripts'
```

### Parameters

To make linking more configurable, there are two types of parameters supported by Upkit: 
* **Built-in parameters:** those with name enclosed by `__`, for instance `__dir__` and `__assets__`, are generated by Upkit and shall not be defined. The list of built-in parameters are defined [here](#builtin-parameters).
* **User parameters:** those defined by user, under `params` section.

For each configuration file, there *MUST* be a `project` parameter defined, which tells Upkit where to generate the links. 
 
#### Defining and expanding parameters
Defining a parameter can be as simple as:

```yaml
params:
  some_param: 'some value'
```

However, most of the time, parameters are defined by expanding other existing parameters using Jinja syntax, such as:
```yaml
params:
  platform: 'ios'
  project: '{{__dir__}}/project-{{platform}}'
  project_settings: '{{project}}/ProjectSettings'
```

#### Builtin parameters

The table below describes Upkit built-in parameters. 

| Name          | Description                                                               |
|---------------|---------------------------------------------------------------------------|
| `__cwd__`     | Path to current working folder.                                           |
| `__dir__`     | Path to the folder containing the current configuration or linkspec file. |
| `__project__` | Path to the Unity project.                                                |
| `__assets__`  | Path to the Unity project's Assets folder.                                |
| `__plugins__` | Path to the Unity project's Plugins folder.                               |
| `__source__`  | The source parameter in a linkspec.                                       |
| `__target__`  | The target parameter in a linkspec.                                       |

Note that only `__cwd__` and `__dir__` are accessible in `params` section. 

#### Overwriting parameters

Given a configuration, its user-defined parameters can be overwriten at runtime by passing `-p name=value` to the `link` command. This is particularly useful when you need to use the configuration file as a template for multiple Unity projects with slightly different parameters. For example, a configuration for multiple platforms may look like: 

```yaml
params:
  platform: 'ios'
  project: '{{__dir__}}/project-{{platform}}'
...
```

Execute the following commands:
```
$ upkit link
$ upkit link -p platform=android
$ upkit link -p platform=windows 
```

will create `project-ios`, `project-android` and `project-windows` as separate Unity project folders.

### Linkspec

To generate Unity projects, Upkit requires a list of link specifications, or *linkspec*s, which is basically a way to tell Upkit where to find a package, its content (all or partial) and a target to which the content is linked. A linkspec may be defined using properties in the table below:

**Linkspec properties**

| Name      | Description                                                                |
|-----------|----------------------------------------------------------------------------|
| `source`  | Source package location, can be a local or remote package.                 |
| `content` | Patterns describing source content.                                        |
| `exclude` | Patterns describing files and folders not included in the  source content. |
| `target`  | The target to which the source or its content is linked.                   |
| `links`   | A list of sub-linkspecs for more complex linking.                          |


#### `source` property
The `source` property describes a source package location where Upkit can find files and folder to link. There are three types of source packages supported by Upkit:
* **Local file or folder**, where `source` takes the syntax `/path/to/local-file-or-folder`. 
* **A Nuget package**, where `source` takes the syntax `nuget:(package_id)@(package_version)[#(sub_path)]`, in which: 
  * `package_id` and `package_verion` are required.
  * `sub_path` is optional.
* **A Git repository**, where `source` takes the syntax `git:(repository_url)[@(branch_or_tag)][#(sub_path)]`, in which:
  * `repository_url` is required.
  * `branch_or_tag` and `sub_path` are optional.

When `source` refers to a Nuget package or a Git repository, Upkit first resolves the package or repository into a local folder under the container folder given by `-w` parameter, and then uses the local folder as a local source. If `sub_path` is given, the sub-path in the resolved folder is used as the local source instead.
  
Examples:
* `{{__dir__}}/Scripts`
* `nuget:NewtonSoft.Json@11.0.2`
* `nuget:NewtonSoft.Json@11.0.2#lib/net35` 
* `git:https://github.com/finderseyes/upkit.git@develop`
* `git:https://github.com/finderseyes/upkit.git#examples/simple-app`
* `git:https://github.com/finderseyes/upkit.git@develop#examples/simple-app` 

#### `content` property

The `content` property defines which files and folders should be included as a package content. It takes a list of patterns as in the example below:
```yaml
content: ['*']
content: ['scripts/*', 'textures/*']
```

All the patterns are relative to the `source`. By default, if no `content` is given, Upkit simply creates *one* link from `source` to `target`. If `content` is given, it creates multiple links, one for each file of folder in the source content to a file or folder under `target`. For example, given following items match the `content` patterns
```
data/child/A/
data/B.txt
C.png
``` 
When linking, the following links will be created under `target`
```
A/    --> data/child/A/
B.txt --> data/B.txt
C.png --> C.png
```

#### `exclude` property

When `content` is defined, `exclude` can be used to remove some of the files and folders from the source content. `exclude` takes a list of patterns similar to `content`. For example: 
```yaml
content: ['*']
exclude: ['Document', 'Document.meta']
```
will include everything under the source package, except `Document` and `Document.meta`.

#### `target` property

As the name implies, `target` is a local path defining where the source or its content should be linked to. 

#### `links` property

A linkspec may use sub-links, defined by `links` property when it needs more complex linking scenarios, where multiple `targets` is required. Each link in `links` is a linkspec itself, except that it shall not have further sub-links i.e. `source`, `target`, `content`, and `exclude` are allowed but not `links`. 

`links` is often used in package linkspec files as explained in [Package linkspec](#package-linkspec). However, it can also be used to link packages where no linkspec file is provided.

## Package linkspec

### Overwrite package linkspec
